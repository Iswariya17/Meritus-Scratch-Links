const ArgumentType = require('../../extension-support/argument-type');
const BlockType = require('../../extension-support/block-type');
const Cast = require('../../util/cast');
const log = require('../../util/log');
const LanguageDetect = require('languagedetect');
const lngDetector = new LanguageDetect();
//const detect = require('@chattylabs/language-detection')
const blockIconURI = 'data:image/png;base64,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UmVhZHlxyWU8AAADI2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDg4LCAyMDIwLzA3LzEwLTIyOjA2OjUzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMCAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RUIxM0YyMEIxOEZEMTFFQjhFNUVCQzNCQjI1NUM2QkMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUIxM0YyMEMxOEZEMTFFQjhFNUVCQzNCQjI1NUM2QkMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFQjEzRjIwOTE4RkQxMUVCOEU1RUJDM0JCMjU1QzZCQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFQjEzRjIwQTE4RkQxMUVCOEU1RUJDM0JCMjU1QzZCQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pn9eO5oAAB9ZSURBVHja7HwJnFTVlf5331Z7V1UXXb2zNGuzg6LDIigRDEYS40jUCOqIZsFf1ESNMaNR1L+jTqKSaBIH/44mkxgh0QRNABeU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';
const formatMessage = require('format-message');

//const getForecast = require("weather-monitor");
const OpenWeatherMapHelper = require("openweathermap-node");
const AvailableLocales = ['en', 'ja', 'ja-Hira', 'zh-cn'];
const helper = new OpenWeatherMapHelper(
	{
		APPID: 'edb69f9ae600ac6be27d6654221edf0c',
		units: "metric"
	}
);
const Message = {
  train_label_1: {
   
    'en': 'result'
    
},
 label_block: {
    
    'en': 'temperature(celcius)'
    
  },
  label_block1: {
    
    'en': 'humidity'
    
  },
  label_block2: {
    
    'en': 'wind speed'
    
  },
  label_block3: {
    
    'en': 'description'
    
  }

}
let data ;

let a ,b, c, d, son;
class Scratch3weather {
    constructor (runtime) {
        this.runtime = runtime;
		this.value;
		this.locale = this.setLocale();
    }

    getInfo () {
		 this.locale = this.setLocale();
        return {
            id: 'weather',
            name: 'weather-monitor',
			blockIconURI,
            blocks: [
                {
                    opcode: 'writeLog',
                   blockType: BlockType.COMMAND,
                    text: 'place to detect [TEXT]',
                    arguments: {
                        TEXT: {
                            type: ArgumentType.STRING,
                            defaultValue: "chennai"
                        }
                    }
                },
				{
                    opcode: 'writeLog1',
                   blockType: BlockType.COMMAND,
                    text: 'GEO [log] and [lon]',
                    arguments: {
                        log: {
                            type: ArgumentType.STRING,
                            defaultValue: "13.0827"
                        },
						lon:{
							type: ArgumentType.STRING,
                            defaultValue: "80.2707"
						}
                    }
                },
				 {
			opcode: 'getLabel',
			text: Message.label_block[this.locale],
			blockType: BlockType.REPORTER
			},
			{
			opcode: 'getLabel1',
			text: Message.label_block1[this.locale],
			blockType: BlockType.REPORTER
			},
			{
			opcode: 'getLabel2',
			text: Message.label_block2[this.locale],
			blockType: BlockType.REPORTER
			},
			{
			opcode: 'getLabel3',
			text: Message.label_block3[this.locale],
			blockType: BlockType.REPORTER
			}
            ],
            menus: {
            }
        };
    }

    writeLog (args) {
        const text = Cast.toString(args.TEXT);
       
	  helper.getCurrentWeatherByCityName(text, (err, currentWeather) => {
	if(err){
		console.log(err);
	}
	else{
		console.log(currentWeather);
		const { main, name, sys, weather, wind } = currentWeather;
		// son = currentWeather;
		 a = ` ${Math.round(main.temp)}`;
		 b = ` ${Math.round(main.humidity)}`
		 c = ` ${wind.speed}`;
		 d = ` ${weather[0]["main"]}`;
		console.log(a);
		console.log(b);
		console.log(c)
	}
});
    } 
	
	  writeLog1 (args) {
        const log = Cast.toString(args.log);
		 const lat = Cast.toString(args.lon);
       
	 helper.getCurrentWeatherByGeoCoordinates(log, lat, (err, currentWeather) =>  {
	if(err){
		console.log(err);
	}
	else{
		console.log(currentWeather);
		const { main, name, sys, weather, wind } = currentWeather;
		// son = currentWeather;
		 a = ` ${Math.round(main.temp - 273.15)}`;
		 
		 b = ` ${Math.round(main.humidity)}`
		 c = ` ${wind.speed}`;
		 d = ` ${weather[0]["main"]}`;
		console.log(a);
		console.log(b);
		console.log(c)
	}
});
    } 
	
	getLabel() {
		
		return a;
		
}
  getLabel1() {
		
		return b;
		
}
getLabel2() {
		
		return c;
		
}
getLabel3() {
		
		return d;
		
}
  
   setLocale() {
    let locale = formatMessage.setup().locale;
    if (AvailableLocales.includes(locale)) {
      return locale;
    } else {
      return 'en';
    }
  }
  
}

module.exports = Scratch3weather;