const ArgumentType = require('../../extension-support/argument-type');
const BlockType = require('../../extension-support/block-type');
const Cast = require('../../util/cast');
const ml5 = require('ml5');
const blockIconURI = 'data:image/png;base64,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UmVhZHlxyWU8AAADI2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDYwLCAyMDIwLzA1LzEyLTE2OjA0OjE3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzRGMDZCNUREODlFMTFFQUIzMkJDN0E3QUNERTJGNTUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzRGMDZCNUVEODlFMTFFQUIzMkJDN0E3QUNERTJGNTUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3NEYwNkI1QkQ4OUUxMUVBQjMyQkM3QTdBQ0RFMkY1NSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3NEYwNkI1Q0Q4OUUxMUVBQjMyQkM3QTdBQ0RFMkY1NSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkcuHgEAABSHSURBVHja7FwHeFRlun5nJlPDpA7pjU6ItEgUkKoUCy66FlBXuSxYdkXhYgXWFa6KcF1dxfuslSvSBBusslyvBEW8oNJClQDp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';

/**
 * Formatter which is used for translating.
 * When it was loaded as a module, 'formatMessage' will be replaced which is used in the runtime.
 * @type {Function}
 */
let formatMessage = require('format-message');

/**
 * URL to get this extension as a module.
 * When it was loaded as a module, 'extensionURL' will be replaced a URL which is retrieved from.
 * @type {string}
 */
let extensionURL = 'https://champierre.github.io/posenet2scratch/posenet2scratch.mjs';

const Message = {
  x: {
    'ja': 'のx座標',
    'ja-Hira': 'のxざひょう',
    'en': ' x',
    'zh-tw':' x座標'
  },
  y: {
    'ja': 'のy座標',
    'ja-Hira': 'のyざひょう',
    'en': ' y',
    'zh-tw': ' y座標'
  },
  peopleCount: {
    'ja': '人数',
    'ja-Hira': 'にんずう',
    'en': 'people count',
    'zh-tw': '人數'
  },
  nose: {
    'ja': '鼻',
    'ja-Hira': 'はな',
    'en': 'nose',
    'zh-tw': '鼻'
  },
  leftEye: {
    'ja': '左目',
    'ja-Hira': 'ひだりめ',
    'en': 'left eye',
    'zh-tw': '左眼'
  },
  rightEye: {
    'ja': '右目',
    'ja-Hira': 'みぎめ',
    'en': 'right eye',
    'zh-tw': '右眼'
  },
  leftEar: {
    'ja': '左耳',
    'ja-Hira': 'ひだりみみ',
    'en': 'left ear',
    'zh-tw': '左耳'
  },
  rightEar: {
    'ja': '右耳',
    'ja-Hira': 'みぎみみ',
    'en': 'right ear',
    'zh-tw': '右耳'
  },
  leftShoulder: {
    'ja': '左肩',
    'ja-Hira': 'ひだりかた',
    'en': 'left shoulder',
    'zh-tw': '左肩'
  },
  rightShoulder: {
    'ja': '右肩',
    'ja-Hira': 'みぎかた',
    'en': 'right shoulder',
    'zh-tw': '右肩'
  },
  leftElbow: {
    'ja': '左ひじ',
    'ja-Hira': 'ひだりひじ',
    'en': 'left elbow',
    'zh-tw': '左肘'
  },
  rightElbow: {
    'ja': '右ひじ',
    'ja-Hira': 'みぎひじ',
    'en': 'right elbow',
    'zh-tw': '右肘'
  },
  leftWrist: {
    'ja': '左手首',
    'ja-Hira': 'ひだりてくび',
    'en': 'left wrist',
    'zh-tw': '左手腕'
  },
  rightWrist: {
    'ja': '右手首',
    'ja-Hira': 'みぎてくび',
    'en': 'right wrist',
    'zh-tw': '右手腕'
  },
  leftHip: {
    'ja': '左腰',
    'ja-Hira': 'ひだりこし',
    'en': 'left hip',
    'zh-tw': '左腰'
  },
  rightHip: {
    'ja': '右腰',
    'ja-Hira': 'みぎこし',
    'en': 'right hip',
    'zh-tw': '右腰'
  },
  leftKnee: {
    'ja': '左ひざ',
    'ja-Hira': 'ひだりひざ',
    'en': 'left knee',
    'zh-tw': '左膝'
  },
  rightKnee: {
    'ja': '右ひざ',
    'ja-Hira': 'みぎひざ',
    'en': 'right knee',
    'zh-tw': '右膝'
  },
  leftAnkle: {
    'ja': '左足首',
    'ja-Hira': 'ひだりあしくび',
    'en': 'left ankle',
    'zh-tw': '左腳踝'
  },
  rightAnkle: {
    'ja': '右足首',
    'ja-Hira': 'みぎあしくび',
    'en': 'right ankle',
    'zh-tw': '右腳踝'
  },
  getX: {
    'ja': '[PERSON_NUMBER] 人目の [PART] のx座標',
    'ja-Hira': '[PERSON_NUMBER] にんめの [PART] のxざひょう',
    'en': '[PART] x of person no. [PERSON_NUMBER]',
    'zh-tw': '第[PERSON_NUMBER]人[PART]的x座標',
  },
  getY: {
    'ja': '[PERSON_NUMBER] 人目の [PART] のy座標',
    'ja-Hira': '[PERSON_NUMBER] にんめの [PART] のyざひょう',
    'en': '[PART] y of person no. [PERSON_NUMBER]',
    'zh-tw': '第[PERSON_NUMBER]人[PART]的y座標',
  },
  videoToggle: {
    'ja': 'ビデオを[VIDEO_STATE]にする',
    'ja-Hira': 'ビデオを[VIDEO_STATE]にする',
    'en': 'turn video [VIDEO_STATE]',
    'zh-tw': '視訊設為[VIDEO_STATE]',
  },
  on: {
    'ja': '入',
    'ja-Hira': 'いり',
    'en': 'on',
    'zh-tw': '開啟'
  },
  off: {
    'ja': '切',
    'ja-Hira': 'きり',
    'en': 'off',
    'zh-tw':'關閉'
  },
  video_on_flipped: {
    'ja': '左右反転',
    'ja-Hira': 'さゆうはんてん',
    'en': 'on flipped',
    'zh-tw': '翻轉'
  },
}
const AvailableLocales = ['en', 'ja', 'ja-Hira', 'zh-tw'];

class Scratch3Posenet2ScratchBlocks {

    /**
     * @return {string} - the name of this extension.
     */
    static get EXTENSION_NAME() {
      return 'PoseNet2Scratch';
    }
    
    /**
     * @return {string} - the ID of this extension.
     */
    static get EXTENSION_ID() {
      return 'posenet2scratch';
    }
    
    /**
     * URL to get this extension.
     * @type {string}
     */
    static get extensionURL() {
      return extensionURL;
    }
    
    /**
     * Set URL to get this extension.
     * extensionURL will be reset when the module is loaded from the web.
     * @param {string} url - URL
     */
    static set extensionURL(url) {
      extensionURL = url;
    }

    get PERSON_NUMBERS_MENU () {
      return [
          {
              text: '1',
              value: '1'
          },
          {
              text: '2',
              value: '2'
          },
          {
              text: '3',
              value: '3'
          },
          {
              text: '4',
              value: '4'
          },
          {
              text: '5',
              value: '5'
          },
          {
              text: '6',
              value: '6'
          },
          {
              text: '7',
              value: '7'
          },
          {
              text: '8',
              value: '8'
          },
          {
              text: '9',
              value: '9'
          },
          {
              text: '10',
              value: '10'
          }
      ]
    }

    get PARTS_MENU () {
      return [
          {
              text: Message.nose[this.locale],
              value: '0'
          },
          {
              text: Message.leftEye[this.locale],
              value: '1'
          },
          {
              text: Message.rightEye[this.locale],
              value: '2'
          },
          {
              text: Message.leftEar[this.locale],
              value: '3'
          },
          {
              text: Message.rightEar[this.locale],
              value: '4'
          },
          {
              text: Message.leftShoulder[this.locale],
              value: '5'
          },
          {
              text: Message.rightShoulder[this.locale],
              value: '6'
          },
          {
              text: Message.leftElbow[this.locale],
              value: '7'
          },
          {
              text: Message.rightElbow[this.locale],
              value: '8'
          },
          {
              text: Message.leftWrist[this.locale],
              value: '9'
          },
          {
              text: Message.rightWrist[this.locale],
              value: '10'
          },
          {
              text: Message.leftHip[this.locale],
              value: '11'
          },
          {
              text: Message.rightHip[this.locale],
              value: '12'
          },
          {
              text: Message.leftKnee[this.locale],
              value: '13'
          },
          {
              text: Message.rightKnee[this.locale],
              value: '14'
          },
          {
              text: Message.leftAnkle[this.locale],
              value: '15'
          },
          {
              text: Message.rightAnkle[this.locale],
              value: '16'
          }
      ]
    }

    get VIDEO_MENU () {
      return [
          {
            text: Message.off[this.locale],
            value: 'off'
          },
          {
            text: Message.on[this.locale],
            value: 'on'
          },
          {
            text: Message.video_on_flipped[this.locale],
            value: 'on-flipped'
          }
      ]
    }

    constructor (runtime) {
        this.runtime = runtime;
        if (runtime.formatMessage) {
          // Replace 'formatMessage' to a formatter which is used in the runtime.
          formatMessage = runtime.formatMessage;
        }

        this.poses = [];
        this.keypoints = [];
        this.videoEnabled = false;
        this.locale = this.setLocale();

        let detectPose = () => {
          this.video = this.runtime.ioDevices.video.provider.video;
          this.video.width = 480;
          this.video.height = 360;
          this.video.autoplay = true;
          this.videoEnabled = true;

          this.poseNet = ml5.poseNet(this.video, {maxPoseDetections: 10}, ()=>{
            console.log('Model Loaded!');
          });

          this.poseNet.on('pose', (poses)=>{
            if (poses.length > 0 && this.videoEnabled) {
              this.poses = poses;
              this.keypoints = poses[0].pose.keypoints;
            } else {
              this.poses = [];
              this.keypoints = [];
            }
          });
        }

        this.runtime.ioDevices.video.enableVideo().then(detectPose);
    }

    getInfo () {
        this.locale = this.setLocale();

        return {
            id: 'posenet2scratch',
            name: 'PD w Scratch',
            extensionURL: Scratch3Posenet2ScratchBlocks.extensionURL,
            blockIconURI: blockIconURI,
            blocks: [
                {
                    opcode: 'getX',
                    blockType: BlockType.REPORTER,
                    text: Message.getX[this.locale],
                    arguments: {
                        PERSON_NUMBER: {
                            type: ArgumentType.STRING,
                            menu: 'personNumbers',
                            defaultValue: '1'
                        },
                        PART: {
                            type: ArgumentType.STRING,
                            menu: 'parts',
                            defaultValue: '0'
                        }
                    }
                },
                {
                    opcode: 'getY',
                    blockType: BlockType.REPORTER,
                    text: Message.getY[this.locale],
                    arguments: {
                        PERSON_NUMBER: {
                            type: ArgumentType.STRING,
                            menu: 'personNumbers',
                            defaultValue: '1'
                        },
                        PART: {
                            type: ArgumentType.STRING,
                            menu: 'parts',
                            defaultValue: '0'
                        }
                    }
                },
                {   opcode: 'getPeopleCount',
                    blockType: BlockType.REPORTER,
                    text: Message.peopleCount[this.locale]
                },
                {
                    opcode: 'getNoseX',
                    blockType: BlockType.REPORTER,
                    text: Message.nose[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getNoseY',
                    blockType: BlockType.REPORTER,
                    text: Message.nose[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftEyeX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftEye[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftEyeY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftEye[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightEyeX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightEye[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightEyeY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightEye[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftEarX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftEar[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftEarY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftEar[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightEarX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightEar[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightEarY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightEar[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftShoulderX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftShoulder[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftShoulderY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftShoulder[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightShoulderX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightShoulder[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightShoulderY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightShoulder[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftElbowX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftElbow[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftElbowY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftElbow[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightElbowX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightElbow[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightElbowY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightElbow[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftWristX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftWrist[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftWristY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftWrist[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightWristX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightWrist[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightWristY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightWrist[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftHipX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftHip[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftHipY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftHip[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightHipX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightHip[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightHipY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightHip[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftKneeX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftKnee[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftKneeY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftKnee[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightKneeX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightKnee[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightKneeY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightKnee[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getLeftAnkleX',
                    blockType: BlockType.REPORTER,
                    text: Message.leftAnkle[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getLeftAnkleY',
                    blockType: BlockType.REPORTER,
                    text: Message.leftAnkle[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'getRightAnkleX',
                    blockType: BlockType.REPORTER,
                    text: Message.rightAnkle[this.locale] + Message.x[this.locale]
                },
                {
                    opcode: 'getRightAnkleY',
                    blockType: BlockType.REPORTER,
                    text: Message.rightAnkle[this.locale] + Message.y[this.locale]
                },
                {
                    opcode: 'videoToggle',
                    blockType: BlockType.COMMAND,
                    text: Message.videoToggle[this.locale],
                    arguments: {
                        VIDEO_STATE: {
                            type: ArgumentType.STRING,
                            menu: 'videoMenu',
                            defaultValue: 'off'
                        }
                    }
                },
                {
                    opcode: 'setVideoTransparency',
                    text: formatMessage({
                        id: 'videoSensing.setVideoTransparency',
                        default: 'set video transparency to [TRANSPARENCY]',
                        description: 'Controls transparency of the video preview layer'
                    }),
                    arguments: {
                        TRANSPARENCY: {
                            type: ArgumentType.NUMBER,
                            defaultValue: 50
                        }
                    }
                }
            ],
            menus: {
              personNumbers: {
                acceptReporters: true,
                items: this.PERSON_NUMBERS_MENU
              },
              parts: {
                acceptReporters: true,
                items: this.PARTS_MENU
              },
              videoMenu: {
                acceptReporters: false,
                items: this.VIDEO_MENU
              }
            }
        };
    }

    getX (args) {
      if (this.poses[parseInt(args.PERSON_NUMBER, 10) - 1] && this.poses[parseInt(args.PERSON_NUMBER, 10) - 1].pose.keypoints[parseInt(args.PART, 10)]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.poses[parseInt(args.PERSON_NUMBER, 10) - 1].pose.keypoints[parseInt(args.PART, 10)].position.x);
        } else {
          return 240 - this.poses[parseInt(args.PERSON_NUMBER, 10) - 1].pose.keypoints[parseInt(args.PART, 10)].position.x;
        }
      } else {
        return "";
      }
    }

    getY (args) {
      if (this.poses[parseInt(args.PERSON_NUMBER, 10) - 1] && this.poses[parseInt(args.PERSON_NUMBER, 10) - 1].pose.keypoints[parseInt(args.PART, 10)]) {
        return 180 - this.poses[parseInt(args.PERSON_NUMBER, 10) - 1].pose.keypoints[parseInt(args.PART, 10)].position.y;
      } else {
        return "";
      }
    }

    getPeopleCount () {
      return this.poses.length;
    }

    getNoseX () {
      if (this.keypoints[0]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[0].position.x);
        } else {
          return 240 - this.keypoints[0].position.x;
        }
      } else {
        return "";
      }
    }

    getNoseY () {
      if (this.keypoints[0]) {
        return 180 - this.keypoints[0].position.y;
      } else {
        return "";
      }
    }

    getLeftEyeX () {
      if (this.keypoints[1]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[1].position.x);
        } else {
          return 240 - this.keypoints[1].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftEyeY () {
      if (this.keypoints[1]) {
        return 180 - this.keypoints[1].position.y;
      } else {
        return "";
      }
    }

    getRightEyeX () {
      if (this.keypoints[2]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[2].position.x);
        } else {
          return 240 - this.keypoints[2].position.x;
        }
      } else {
        return "";
      }
    }

    getRightEyeY () {
      if (this.keypoints[2]) {
        return 180 - this.keypoints[2].position.y;
      } else {
        return "";
      }
    }

    getLeftEarX () {
      if (this.keypoints[3]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[3].position.x);
        } else {
          return 240 - this.keypoints[3].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftEarY () {
      if (this.keypoints[3]) {
        return 180 - this.keypoints[3].position.y;
      } else {
        return "";
      }
    }

    getRightEarX () {
      if (this.keypoints[4]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[4].position.x);
        } else {
          return 240 - this.keypoints[4].position.x;
        }
      } else {
        return "";
      }
    }

    getRightEarY () {
      if (this.keypoints[4]) {
        return 180 - this.keypoints[4].position.y;
      } else {
        return "";
      }
    }

    getLeftShoulderX () {
      if (this.keypoints[5]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[5].position.x);
        } else {
          return 240 - this.keypoints[5].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftShoulderY () {
      if (this.keypoints[5]) {
        return 180 - this.keypoints[5].position.y;
      } else {
        return "";
      }
    }

    getRightShoulderX () {
      if (this.keypoints[6]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[6].position.x);
        } else {
          return 240 - this.keypoints[6].position.x;
        }
      } else {
        return "";
      }
    }

    getRightShoulderY () {
      if (this.keypoints[6]) {
        return 180 - this.keypoints[6].position.y;
      } else {
        return "";
      }
    }

    getLeftElbowX () {
      if (this.keypoints[7]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[7].position.x);
        } else {
          return 240 - this.keypoints[7].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftElbowY () {
      if (this.keypoints[7]) {
        return 180 - this.keypoints[7].position.y;
      } else {
        return "";
      }
    }

    getRightElbowX () {
      if (this.keypoints[8]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[8].position.x);
        } else {
          return 240 - this.keypoints[8].position.x;
        }
      } else {
        return "";
      }
    }

    getRightElbowY () {
      if (this.keypoints[8]) {
        return 180 - this.keypoints[8].position.y;
      } else {
        return "";
      }
    }

    getLeftWristX () {
      if (this.keypoints[9]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[9].position.x);
        } else {
          return 240 - this.keypoints[9].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftWristY () {
      if (this.keypoints[9]) {
        return 180 - this.keypoints[9].position.y;
      } else {
        return "";
      }
    }

    getRightWristX () {
      if (this.keypoints[10]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[10].position.x);
        } else {
          return 240 - this.keypoints[10].position.x;
        }
      } else {
        return "";
      }
    }

    getRightWristY () {
      if (this.keypoints[10]) {
        return 180 - this.keypoints[10].position.y;
      } else {
        return "";
      }
    }

    getLeftHipX () {
      if (this.keypoints[11]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[11].position.x);
        } else {
          return 240 - this.keypoints[11].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftHipY () {
      if (this.keypoints[11]) {
        return 180 - this.keypoints[11].position.y;
      } else {
        return "";
      }
    }

    getRightHipX () {
      if (this.keypoints[12]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[12].position.x);
        } else {
          return 240 - this.keypoints[12].position.x;
        }
      } else {
        return "";
      }
    }

    getRightHipY () {
      if (this.keypoints[12]) {
        return 180 - this.keypoints[12].position.y;
      } else {
        return "";
      }
    }

    getLeftKneeX () {
      if (this.keypoints[13]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[13].position.x);
        } else {
          return 240 - this.keypoints[13].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftKneeY () {
      if (this.keypoints[13]) {
        return 180 - this.keypoints[13].position.y;
      } else {
        return "";
      }
    }

    getRightKneeX () {
      if (this.keypoints[14]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[14].position.x);
        } else {
          return 240 - this.keypoints[14].position.x;
        }
      } else {
        return "";
      }
    }

    getRightKneeY () {
      if (this.keypoints[14]) {
        return 180 - this.keypoints[14].position.y;
      } else {
        return "";
      }
    }

    getLeftAnkleX () {
      if (this.keypoints[15]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[15].position.x);
        } else {
          return 240 - this.keypoints[15].position.x;
        }
      } else {
        return "";
      }
    }

    getLeftAnkleY () {
      if (this.keypoints[15]) {
        return 180 - this.keypoints[15].position.y;
      } else {
        return "";
      }
    }

    getRightAnkleX () {
      if (this.keypoints[16]) {
        if (this.runtime.ioDevices.video.mirror === false) {
          return -1 * (240 - this.keypoints[16].position.x);
        } else {
          return 240 - this.keypoints[16].position.x;
        }
      } else {
        return "";
      }
    }

    getRightAnkleY () {
      if (this.keypoints[16]) {
        return 180 - this.keypoints[16].position.y;
      } else {
        return "";
      }
    }

    videoToggle (args) {
      let state = args.VIDEO_STATE;
      if (state === 'off') {
        this.globalVideoTransparency = 100;
        this.runtime.ioDevices.video.setPreviewGhost(100);
        this.videoEnabled = false;
      } else {
        this.globalVideoTransparency = 0;
        this.runtime.ioDevices.video.setPreviewGhost(0);
        this.runtime.ioDevices.video.mirror = state === "on";
        this.videoEnabled = true;
      }
    }

    /**
     * A scratch command block handle that configures the video preview's
     * transparency from passed arguments.
     * @param {object} args - the block arguments
     * @param {number} args.TRANSPARENCY - the transparency to set the video
     *   preview to
     */
    setVideoTransparency (args) {
      const transparency = Cast.toNumber(args.TRANSPARENCY);
      this.globalVideoTransparency = transparency;
      this.runtime.ioDevices.video.setPreviewGhost(transparency);
    }

    setLocale() {
      let locale = formatMessage.setup().locale;
      if (AvailableLocales.includes(locale)) {
        return locale;
      } else {
        return 'en';
      }
    }
}

exports.blockClass = Scratch3Posenet2ScratchBlocks;
module.exports = Scratch3Posenet2ScratchBlocks;
