const ArgumentType = require('../../extension-support/argument-type');
const BlockType = require('../../extension-support/block-type');
const Cast = require('../../util/cast');
const blockIconURI = 'data:image/png;base64,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UmVhZHlxyWU8AAADI2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDYwLCAyMDIwLzA1LzEyLTE2OjA0OjE3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Nzg3RDRFOTlEODlFMTFFQUFDMDZGM0Y4RjA2ODk5NzgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Nzg3RDRFOUFEODlFMTFFQUFDMDZGM0Y4RjA2ODk5NzgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3ODdENEU5N0Q4OUUxMUVBQUMwNkYzRjhGMDY4OTk3OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3ODdENEU5OEQ4OUUxMUVBQUMwNkYzRjhGMDY4OTk3OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pq0K6EEAABX5SURBVHja7FsJdFvllb7vSXraLdmWZcV27HjJZocsZKckhZACCThsEyAEWiBAyjJTOMP0AFOWspSynZbhHGCSGegMgRaGEtay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';

const SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;

/**
 * URL to get this extension as a module.
 * When it was loaded as a module, 'extensionURL' will be replaced a URL which is retrieved from.
 * @type {string}
 */
let extensionURL = 'https://champierre.github.io/speech2scratch/speech2scratch.mjs';

class Scratch3Speech2Scratch {

    /**
     * @return {string} - the name of this extension.
     */
    static get EXTENSION_NAME() {
        return 'Speech2Scratch';
    }

    /**
     * @return {string} - the ID of this extension.
     */
    static get EXTENSION_ID() {
        return 'speech2scratch';
    }

    /**
     * URL to get this extension.
     * @type {string}
     */
    static get extensionURL() {
        return extensionURL;
    }

    /**
     * Set URL to get this extension.
     * extensionURL will be reset when the module is loaded from the web.
     * @param {string} url - URL
     */
    static set extensionURL(url) {
        extensionURL = url;
    }

    constructor (runtime) {
        this.runtime = runtime;
        this.speech = '';
    }

    getInfo () {
        return {
            id: Scratch3Speech2Scratch.EXTENSION_ID,
            name: 'SR w Scratch ',
            extensionURL: Scratch3Speech2Scratch.extensionURL,
            blockIconURI: blockIconURI,
            blocks: [
                {
                    opcode: 'startRecognition',
                    blockType: BlockType.COMMAND,
                    text: '音声認識開始'
                },
                {
                    opcode: 'getSpeech',
                    blockType: BlockType.REPORTER,
                    text: '音声'
                }
            ],
            menus: {
            }
        };
    }

    startRecognition () {
        const recognition = new SpeechRecognition();
        recognition.onresult = (event) => {
            this.speech = event.results[0][0].transcript;
        }
        this.speech = '';
        recognition.start();
    }

    getSpeech() {
        return this.speech;
    }
}

exports.blockClass = Scratch3Speech2Scratch; // loadable-extension needs this line.
module.exports = Scratch3Speech2Scratch;
